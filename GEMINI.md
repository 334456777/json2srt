# GEMINI.md

## Project Overview

This project is a Go-based utility designed to convert JSON files generated by OpenAI Whisper into SubRip (SRT) subtitle files. Specifically, it handles Whisper's output that includes word-level timestamps, preserving this fine-grained timing information in the final SRT file.

The program automatically scans the current directory for `.json` files, processes them in parallel using a pool of workers (sized to the number of CPU cores), and generates a corresponding `.srt` file for each input. The generated SRT files are encoded with a BOM to ensure proper display of Chinese characters.

The core logic reads the JSON structure, extracts segments and their associated tokens, and then constructs SRT blocks with precise start and end times for each transcribed line.

## Building and Running

### Dependencies

- Go 1.16 or higher

### Running the application

You can run the application directly using `go run`:

```sh
go run main.go
```

### Building the application

To build a standalone executable, you can use the `go build` command or the provided `Makefile`:

**Using go build:**

```sh
go build -o json2srt main.go
```

Then run the compiled binary:

```sh
./json2srt
```

**Using Makefile:**

```sh
# Build the executable
make build

# Clean up build artifacts
make clean
```

## Development Conventions

- **Concurrency:** The application uses Go's concurrency features for performance. It spawns a worker goroutine for each available CPU core to process multiple files in parallel. A `sync.WaitGroup` is used to ensure all files are processed before the program exits.
- **Context Management:** A `context.Context` is used to manage the lifecycle of the worker goroutines, allowing for graceful cancellation.
- **File Handling:** The application reads all `.json` files from the current working directory. The output `.srt` files are written to the same directory.
- **Error Handling:** Errors are handled at each step of the process (file reading, JSON parsing, file writing) and logged to the console.
- **Code Structure:** The code is organized into a single `main` package. It defines structs that map to the Whisper JSON output format, and functions for file processing, timestamp extraction, and worker management.
